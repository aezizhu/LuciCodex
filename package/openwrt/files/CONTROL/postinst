#!/bin/sh

# Initialize UCI config if it doesn't exist
[ -f /etc/config/lucicodex ] || {
    touch /etc/config/lucicodex
    uci -q batch <<-EOF
		add lucicodex api
		set lucicodex.@api[0].provider='gemini'
		set lucicodex.@api[0].key=''
		set lucicodex.@api[0].model='gemini-2.5-flash'
		set lucicodex.@api[0].endpoint='https://generativelanguage.googleapis.com/v1beta'
		set lucicodex.@api[0].openai_key=''
		set lucicodex.@api[0].anthropic_key=''
		add lucicodex settings
		set lucicodex.@settings[0].dry_run='1'
		set lucicodex.@settings[0].confirm_each='0'
		set lucicodex.@settings[0].timeout='30'
		set lucicodex.@settings[0].max_commands='10'
		set lucicodex.@settings[0].log_file='/tmp/lucicodex.log'
		commit lucicodex
EOF
    echo "LuciCodex: Created default configuration at /etc/config/lucicodex"
}

# Create lock directory if needed
[ -d /var/lock ] || mkdir -p /var/lock

exit 0
