<%
local uci = require "luci.model.uci".cursor()

-- Check configuration status
local function get_config(option)
    local val = uci:get("lucicodex", "main", option)
    if not val or val == "" then
        val = uci:get("lucicodex", "@settings[0]", option)
    end
    return val or ""
end

local provider = get_config("provider") or "gemini"
local gemini_key = get_config("key")
local openai_key = get_config("openai_key")
local anthropic_key = get_config("anthropic_key")

local is_configured = false
local active_provider_name = "Not configured"

if provider == "gemini" and gemini_key and gemini_key ~= "" then
    is_configured = true
    active_provider_name = "Google Gemini"
elseif provider == "openai" and openai_key and openai_key ~= "" then
    is_configured = true
    active_provider_name = "OpenAI"
elseif provider == "anthropic" and anthropic_key and anthropic_key ~= "" then
    is_configured = true
    active_provider_name = "Anthropic Claude"
end
%>

    <style>
        :root {
            --bg-body: #000000;
            --bg-card: #1c1c1e;
            --bg-card-hover: #2c2c2e;
            --text-primary: #F5F5F7;
            --text-secondary: #86868b;
            --accent-blue: #007AFF;
            --accent-green: #34C759;
            --accent-orange: #FF9500;
            --accent-red: #FF3B30;
            --border-subtle: rgba(255, 255, 255, 0.1);
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-stack);
            background: var(--bg-body);
            color: var(--text-primary);
        }

        .overview-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 700;
            margin: 0 0 10px 0;
        }

        .hero-subtitle {
            font-size: 20px;
            color: var(--text-secondary);
        }

        .status-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 18px;
            padding: 24px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 32px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
        }
    </style>

    <div class="overview-container">
        <div class="hero-section">
            <div class="hero-icon">ü§ñ</div>
            <h1 class="hero-title">LuciCodex</h1>
            <p class="hero-subtitle">Your intelligent router assistant</p>
        </div>

        <div class="status-card">
            <div>
                <h3>System Status</h3>
                <% if is_configured then %>
                    <p>Connected to <%=active_provider_name%></p>
                <% else %>
                    <p>Configuration required</p>
                <% end %>
            </div>
        </div>

        <div class="features-grid">
            <a href="<%=url('admin/system/lucicodex/run')%>" class="feature-card">
                <div>üí¨</div>
                <h3>Chat Assistant</h3>
                <p>Control your router using natural language</p>
            </a>

            <a href="<%=url('admin/system/lucicodex/config')%>" class="feature-card">
                <div>‚öôÔ∏è</div>
                <h3>Configuration</h3>
                <p>Manage AI providers and API keys</p>
            </a>

            <a href="<%=url('admin/system/l ucicodex/metrics')%>" class="feature-card">
                <div>üìä</div>
                <h3>Metrics</h3>
                <p>View usage statistics</p>
            </a>
        </div>

        <%+footer%>
    </div>
